"use strict";(self.webpackChunkwaku_guide=self.webpackChunkwaku_guide||[]).push([[9830],{24033:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"guides/nwaku/run-docker-compose","title":"Run Nwaku with Docker Compose","description":"nwaku-compose is a ready-to-use Docker Compose setup that configures the following automatically:","source":"@site/docs/guides/nwaku/run-docker-compose.md","sourceDirName":"guides/nwaku","slug":"/guides/nwaku/run-docker-compose","permalink":"/guides/nwaku/run-docker-compose","draft":false,"unlisted":false,"editUrl":"https://github.com/waku-org/docs.waku.org/tree/develop/docs/guides/nwaku/run-docker-compose.md","tags":[],"version":"current","lastUpdatedAt":null,"frontMatter":{"title":"Run Nwaku with Docker Compose","hide_table_of_contents":true},"sidebar":"guides","previous":{"title":"Run a Nwaku Node","permalink":"/guides/nwaku/run-node"},"next":{"title":"Run Nwaku in a Docker Container","permalink":"/guides/nwaku/run-docker"}}');var t=o(74848),r=o(28453);const i={title:"Run Nwaku with Docker Compose",hide_table_of_contents:!0},a=void 0,c={},d=[{value:"Video tutorial",id:"video-tutorial",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Clone the repository",id:"clone-the-repository",level:2},{value:"Configure the setup",id:"configure-the-setup",level:2},{value:"Register for RLN membership",id:"register-for-rln-membership",level:2},{value:"Run the node",id:"run-the-node",level:2},{value:"Monitor the node",id:"monitor-the-node",level:2},{value:"Interact with the node",id:"interact-with-the-node",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/waku-org/nwaku-compose",children:"nwaku-compose"})," is a ready-to-use Docker Compose setup that configures the following automatically:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nwaku"})," node running ",(0,t.jsx)(n.a,{href:"/learn/concepts/protocols#relay",children:"Relay"})," and ",(0,t.jsx)(n.a,{href:"/learn/concepts/protocols#store",children:"Store"})," protocols with ",(0,t.jsx)(n.a,{href:"/learn/concepts/protocols#rln-relay",children:"RLN"})," enabled."]}),"\n",(0,t.jsx)(n.li,{children:"Simple frontend to interact with the node and Waku network to send and receive messages."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://grafana.com/",children:"Grafana"})," metrics dashboard for advanced users and node operators to monitor the node."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"video-tutorial",children:"Video tutorial"}),"\n",(0,t.jsx)("div",{class:"video-container",children:(0,t.jsx)("iframe",{class:"yt-video",src:"https://www.youtube.com/embed/fs0ynLk4z0I",title:"How to run a Waku node using Nwaku Compose",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Check out the ",(0,t.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:o(96343).A+"",children:"Waku Node Operator Cheatsheet"})," to learn how to easily run, monitor, and interact with a node."]})}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://git-scm.com/",children:"Git"})," or ",(0,t.jsx)(n.a,{href:"https://desktop.github.com/",children:"GitHub Desktop"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/install/",children:"Docker"})," and ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"Docker Compose"})]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/waku-org/nwaku/blob/master/docs/tutorial/pre-requisites-of-running-on-chain-spam-protected-chat2.md#3-access-a-node-on-the-sepolia-testnet-using-infura",children:"Ethereum Sepolia HTTPS Endpoint"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/waku-org/nwaku/blob/master/docs/tutorial/pre-requisites-of-running-on-chain-spam-protected-chat2.md#2-obtain-sepolia-eth-from-faucet",children:"Wallet with Sepolia Ethereum"})," (~0.6 Sepolia ETH)"]}),"\n",(0,t.jsx)(n.li,{children:"A password to protect your RLN membership"}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["We recommend running a ",(0,t.jsx)(n.code,{children:"nwaku"})," node with at least 2GB of RAM, especially if ",(0,t.jsx)(n.code,{children:"WSS"})," is enabled. If running just a ",(0,t.jsx)(n.code,{children:"Relay"})," node, 0.5GB of RAM is sufficient."]})}),"\n",(0,t.jsx)(n.h2,{id:"clone-the-repository",children:"Clone the repository"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"git clone https://github.com/waku-org/nwaku-compose\ncd nwaku-compose\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configure-the-setup",children:"Configure the setup"}),"\n",(0,t.jsxs)(n.p,{children:["Docker Compose ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/environment-variables/set-environment-variables/#additional-information-3",children:"reads the .env file"})," from the filesystem. You can use ",(0,t.jsx)(n.code,{children:".env.example"})," as a template to provide the configuration values. The recommended process for working with ",(0,t.jsx)(n.code,{children:".env"})," files is to duplicate ",(0,t.jsx)(n.code,{children:".env.example"}),", rename it as ",(0,t.jsx)(n.code,{children:".env"}),", and then make the necessary value edits."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cp .env.example .env\n${EDITOR} .env\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Ensure that you do ",(0,t.jsx)(n.strong,{children:"NOT"})," include any secrets in the ",(0,t.jsx)(n.code,{children:".env.example"})," file, as it could accidentally be shared in your Git repository."]})}),"\n",(0,t.jsx)(n.h2,{id:"register-for-rln-membership",children:"Register for RLN membership"}),"\n",(0,t.jsxs)(n.p,{children:["The RLN membership is your access key to The Waku Network. Its registration is done on-chain, allowing your ",(0,t.jsx)(n.code,{children:"nwaku"})," node to send messages decentralised and privately, respecting some rate limits. Other peers won't relay messages that exceed the rate limit."]}),"\n",(0,t.jsxs)(n.p,{children:["This command registers your membership and saves it in the ",(0,t.jsx)(n.code,{children:"keystore/keystore.json"})," file. You should have Docker running at this step:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"./register_rln.sh\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"If you only want to relay traffic without sending messages to the network, you don't need to register for RLN membership."})}),"\n",(0,t.jsx)(n.h2,{id:"run-the-node",children:"Run the node"}),"\n",(0,t.jsxs)(n.p,{children:["Launch all the processes: ",(0,t.jsx)(n.code,{children:"nwaku"})," node, database for storing messages, and Grafana for metrics with the following command. Your RLN membership is loaded into ",(0,t.jsx)(n.code,{children:"nwaku"})," under the hood:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker-compose up -d\n"})}),"\n",(0,t.jsx)(n.p,{children:"View the logs of the node to confirm that it is running correctly:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker-compose logs -f nwaku\n"})}),"\n",(0,t.jsx)(n.h2,{id:"monitor-the-node",children:"Monitor the node"}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.a,{href:"http://localhost:3000/d/yns_4vFVk/nwaku-monitoring",children:"http://localhost:3000/d/yns_4vFVk/nwaku-monitoring"})," to view your node metrics in real time."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"nwaku compose dashboard",src:o(90957).A+"",width:"1080",height:"721"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["To access Grafana from outside your machine, remove ",(0,t.jsx)(n.code,{children:"127.0.0.1"})," and open the port. Consider setting up a password for Grafana to ensure security."]})}),"\n",(0,t.jsx)(n.h2,{id:"interact-with-the-node",children:"Interact with the node"}),"\n",(0,t.jsxs)(n.p,{children:["Your ",(0,t.jsx)(n.code,{children:"nwaku"})," node provides a ",(0,t.jsx)(n.a,{href:"https://waku-org.github.io/waku-rest-api/",children:"REST API"})," on port ",(0,t.jsx)(n.code,{children:"8645"})," for interacting with it:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Get nwaku version\ncurl --location 'http://127.0.0.1:8645/debug/v1/version'\n\n# Get nwaku info\ncurl --location 'http://127.0.0.1:8645/debug/v1/info'\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Send a message to a ",(0,t.jsx)(n.code,{children:"contentTopic"}),", which all subscribers will receive. Please note that the ",(0,t.jsx)(n.code,{children:"payload"})," is encoded in ",(0,t.jsx)(n.code,{children:"base64"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl --location \'http://127.0.0.1:8645/relay/v1/auto/messages\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n    "payload": "\'$(echo -n "Hello Waku Network - from Anonymous User" | base64)\'",\n    "contentTopic": "/my-app/2/chatroom-1/proto"\n}\'\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Retrieve messages sent to a ",(0,t.jsx)(n.code,{children:"contentTopic"}),". Please note that this query can be made to any ",(0,t.jsx)(n.code,{children:"Store"})," node within the network:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl --location 'http://127.0.0.1:8645/store/v1/messages?contentTopics=%2Fmy-app%2F2%2Fchatroom-1%2Fproto&pageSize=50&ascending=true' \\\n--header 'Accept: application/json'\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["If you encounter issues running your node or require assistance with anything, please visit the ",(0,t.jsx)(n.a,{href:"https://discord.com/channels/1110799176264056863/1216748184592711691",children:"#node-help channel"})," on our Discord."]})}),"\n",(0,t.jsx)(n.admonition,{title:"Congratulations!",type:"tip",children:(0,t.jsxs)(n.p,{children:["You have successfully started a ",(0,t.jsx)(n.code,{children:"nwaku"})," node with ",(0,t.jsx)(n.code,{children:"RLN"})," enabled using Docker Compose. Have a look at the ",(0,t.jsx)(n.a,{href:"/guides/nwaku/configure-nwaku",children:"Node Configuration Examples"})," and ",(0,t.jsx)(n.a,{href:"https://github.com/waku-org/nwaku-compose/blob/master/ADVANCED.md",children:"Advanced Configuration"})," guides to learn how to configure ",(0,t.jsx)(n.code,{children:"nwaku"})," for different use cases."]})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>a});var s=o(96540);const t={},r=s.createContext(t);function i(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},90957:(e,n,o)=>{o.d(n,{A:()=>s});const s=o.p+"assets/images/nwaku-compose-dashboard-c0fdabab598b734808be427ff6b24672.png"},96343:(e,n,o)=>{o.d(n,{A:()=>s});const s=o.p+"assets/files/Waku-NodeOperator-7fabb782473f2619b0b05dc209f12f53.pdf"}}]);