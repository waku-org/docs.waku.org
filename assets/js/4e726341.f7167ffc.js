"use strict";(self.webpackChunkwaku_guide=self.webpackChunkwaku_guide||[]).push([[2588],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var r=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,i=function(e,t){if(null==e)return{};var a,r,i={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=r.createContext({}),u=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,i=e.mdxType,n=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(a),d=i,m=p["".concat(l,".").concat(d)]||p[d]||h[d]||n;return a?r.createElement(m,s(s({ref:t},c),{},{components:a})):r.createElement(m,s({ref:t},c))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var n=a.length,s=new Array(n);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[p]="string"==typeof e?e:i,s[1]=o;for(var u=2;u<n;u++)s[u]=a[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},82493:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>n,metadata:()=>o,toc:()=>u});var r=a(87462),i=(a(67294),a(3905));const n={title:"Incentivisation"},s=void 0,o={unversionedId:"research/research-and-studies/incentivisation",id:"research/research-and-studies/incentivisation",title:"Incentivisation",description:"Waku is a family of decentralised communication protocols. The Waku Network (TWN) consists of independent nodes running Waku protocols. TWN needs incentivisation (shortened to i13n) to ensure proper node behaviour.",source:"@site/docs/research/research-and-studies/incentivisation.md",sourceDirName:"research/research-and-studies",slug:"/research/research-and-studies/incentivisation",permalink:"/research/research-and-studies/incentivisation",draft:!1,editUrl:"https://github.com/waku-org/docs.waku.org/tree/develop/docs/research/research-and-studies/incentivisation.md",tags:[],version:"current",lastUpdatedAt:1708340432,formattedLastUpdatedAt:"19 Feb 2024",frontMatter:{title:"Incentivisation"},sidebar:"research",previous:{title:"Capped Bandwidth in Waku",permalink:"/research/research-and-studies/capped-bandwidth"},next:{title:"Maximum Bandwidth for Global Adoption",permalink:"/research/research-and-studies/maximum-bandwidth"}},l={},u=[{value:"Incentivisation tools",id:"incentivisation-tools",level:2},{value:"Prior work",id:"prior-work",level:2},{value:"Early P2P file-sharing",id:"early-p2p-file-sharing",level:3},{value:"Blockchains",id:"blockchains",level:3},{value:"Decentralised storage",id:"decentralised-storage",level:3},{value:"Waku i13n challenges",id:"waku-i13n-challenges",level:2},{value:"Waku Store",id:"waku-store",level:2},{value:"Pricing",id:"pricing",level:2},{value:"Future work",id:"future-work",level:3},{value:"Payment",id:"payment",level:2},{value:"Future work",id:"future-work-1",level:3},{value:"Reputation",id:"reputation",level:2},{value:"Future work",id:"future-work-2",level:3},{value:"Results cross-checking",id:"results-cross-checking",level:2},{value:"Future work",id:"future-work-3",level:3}],c={toc:u},p="wrapper";function h(e){let{components:t,...a}=e;return(0,i.kt)(p,(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Waku is a family of decentralised communication protocols. The Waku Network (TWN) consists of independent nodes running Waku protocols. TWN needs incentivisation (shortened to i13n) to ensure proper node behaviour."),(0,i.kt)("p",null,"The goal of this document is to outline and contextualize our approach to TWN i13n. After providing an overview of Waku and relevant prior work, we focus on Waku Store - a client-server protocol for querying historical messages. We introduce a minimal viable addition to Store to enable i13n, and list research directions for future work."),(0,i.kt)("h1",{id:"incentivisation-in-decentralised-networks"},"Incentivisation in decentralised networks"),(0,i.kt)("h2",{id:"incentivisation-tools"},"Incentivisation tools"),(0,i.kt)("p",null,"We can think of incentivisation tools as a two-by-two matrix:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"rewards vs punishment;"),(0,i.kt)("li",{parentName:"ul"},"monetary vs reputation.")),(0,i.kt)("p",null,"In other words, there are four quadrants:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"monetary reward: the node gets rewarded;"),(0,i.kt)("li",{parentName:"ul"},"monetary punishment: the nodes deposits funds that are taken away (slashed) if it misbehaves;"),(0,i.kt)("li",{parentName:"ul"},"reputation reward: the node's reputation increases if it behaves well;"),(0,i.kt)("li",{parentName:"ul"},"reputation punishment: the node's reputation decreases if it behaves badly.")),(0,i.kt)("p",null,"Reputation only works if high reputation brings tangible benefits. For example, if nodes chose neighbors based on reputation, low-reputation nodes miss out on potential revenue. Reputation scores may be local (a node assigns scores to its neighbors) or global (each node gets a uniform score). Global reputation in its simplest form involves a trusted third party, although decentralised approaches are also possible."),(0,i.kt)("h2",{id:"prior-work"},"Prior work"),(0,i.kt)("p",null,"We may split incentivized decentralised networks into early file-sharing, blockchains, and decentralised storage."),(0,i.kt)("h3",{id:"early-p2p-file-sharing"},"Early P2P file-sharing"),(0,i.kt)("p",null,"Early P2P file-sharing networks employ reputation-based approaches and sticky defaults. For instance, the BitTorrent protocol rewards uploading peers with faster downloads. The download bandwidth available to a peer depends on how much it has uploaded. Moreover, peers share pieces of a file before having received it in whole. This non-monetary i13n policy has been proved to work in practice."),(0,i.kt)("h3",{id:"blockchains"},"Blockchains"),(0,i.kt)("p",null,"Bitcoin has introduced proof-of-work (PoW) for native monetary rewards in a P2P network. PoW miners are automatically assigned newly mined coins for generating blocks. Miners must expend physical resources to generate a block. If the block is invalid, these expenses are not compensated (implicit monetary punishment). Proof-of-stake (PoS), used in Ethereum and many other cryptocurrencies, introduces explicit monetary punishments. PoS validators lock up (stake) native tokens and get rewarded for validating blocks or slashed for misbehaviour."),(0,i.kt)("h3",{id:"decentralised-storage"},"Decentralised storage"),(0,i.kt)("p",null,"Post-Bitcoin decentralised storage networks include Codex, Storj, Sia, Filecoin, IPFS. Their i13n methods combine techniques from early P2P file-sharing with blockchain-inspired reward mechanisms."),(0,i.kt)("h1",{id:"waku-background"},"Waku background"),(0,i.kt)("p",null,"Waku is a ",(0,i.kt)("a",{parentName:"p",href:"https://waku.org/about/architect"},"family of protocols")," for a modular privacy-preserving censorship-resistant decentralised communication network. The backbone of Waku is the Relay protocol (and its spam-protected version ",(0,i.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/17/"},"RLN-Relay"),"). Additionally, there are light protocols: Store, Filter, and Lightpush. Light protocols are also referred to as client-server protocols and request-response protocols."),(0,i.kt)("p",null,"A server is a node running Relay and a server-side of at least one light protocol. A client is a node running a client-side of any of the light protocols. A server may sometimes be referred to as a full node, and a client as a light node. There is no strict definition of a full node vs a light node in Waku (see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/waku-org/research/issues/28"},"discussion"),")."),(0,i.kt)("p",null,"In light protocols, a client sends a request to a server, and a server performs some actions and returns a response:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/spec/13/"},"Store"),": the server responds with messages relayed that match a set of criteria;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/spec/12/"},"Filter"),": the server will relay (only) messages that pass a filter to the client;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/spec/19/"},"Lightpush"),": the server publishes the client's message to the Relay network.")),(0,i.kt)("h2",{id:"waku-i13n-challenges"},"Waku i13n challenges"),(0,i.kt)("p",null,"Waku has no consensus and no native token, which brings it closer to reputation-incentivised file-sharing networks. As of late 2023, Waku only operates under reputation-based rewards and punishments. While ",(0,i.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/17/"},"RLN-Relay")," adds monetary punishments for spammers, slashing is yet to be activated."),(0,i.kt)("p",null,"Monetary rewards and punishments should ideally be atomically linked with the node's behaviour. A benefit of blockchains in this respect is that the desired behaviour of miners or validators can be verified automatically. Enforcing atomicity in a communication network is more challenging: it is non-trivial to prove that a given piece of data has been relayed."),(0,i.kt)("p",null,"Our goal is to combine monetary and reputation-based incentives for Waku. Monetary incentives have demonstrated their robustness in blockchains. We think they are necessary to scale the network beyond the initial phase when it's maintained altruistically."),(0,i.kt)("h2",{id:"waku-store"},"Waku Store"),(0,i.kt)("p",null,"Waku Store is a light protocol for querying historic messages that works as follows:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"the client sends a ",(0,i.kt)("inlineCode",{parentName:"li"},"HistoryQuery")," to the server;"),(0,i.kt)("li",{parentName:"ol"},"the server sends a ",(0,i.kt)("inlineCode",{parentName:"li"},"HistoryResponse")," to the client.")),(0,i.kt)("p",null,"The response may be split into multiple parts, as specified by pagination parameters in ",(0,i.kt)("inlineCode",{parentName:"p"},"PagingInfo"),"."),(0,i.kt)("p",null,"We define a ",(0,i.kt)("em",{parentName:"p"},"relevant")," message as a message that matches client-defined criteria (e.g., relayed within a given time frame). Upon receiving a request, a server should quickly send back a response containing all and only relevant messages."),(0,i.kt)("h1",{id:"waku-store-incentivisation"},"Waku Store incentivisation"),(0,i.kt)("p",null,"An incentivised Store protocol has the following extra steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"pricing:",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"cost calculation"),(0,i.kt)("li",{parentName:"ol"},"price advertisement"),(0,i.kt)("li",{parentName:"ol"},"price negotiation"))),(0,i.kt)("li",{parentName:"ol"},"payment:",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"payment itself"),(0,i.kt)("li",{parentName:"ol"},"proof of payment"))),(0,i.kt)("li",{parentName:"ol"},"reputation"),(0,i.kt)("li",{parentName:"ol"},"results cross-checking")),(0,i.kt)("p",null,"In this document, we focus on the simplest proof-of-concept (PoC) i13n for Store. Compared to the fully-fledged protocol, the PoC version is simplified in the following ways:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"cost calculation is based on a common-knowledge price;"),(0,i.kt)("li",{parentName:"ul"},"there is no price advertisement and no price negotiation;"),(0,i.kt)("li",{parentName:"ul"},"each query is paid for in a separate transaction, ",(0,i.kt)("inlineCode",{parentName:"li"},"txid")," acts a proof of payment;"),(0,i.kt)("li",{parentName:"ul"},"the reputation system is simplified (see below);"),(0,i.kt)("li",{parentName:"ul"},"the results are not cross-checked.")),(0,i.kt)("p",null,"In the PoC protocol:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"the client calculates the price based on the known rate per hour of history;"),(0,i.kt)("li",{parentName:"ol"},"the client pays the appropriate amount to the server's address;"),(0,i.kt)("li",{parentName:"ol"},"the client sends a ",(0,i.kt)("inlineCode",{parentName:"li"},"HistoryQuery")," to the server alongside the proof of payment (",(0,i.kt)("inlineCode",{parentName:"li"},"txid"),");"),(0,i.kt)("li",{parentName:"ol"},"the server checks that the ",(0,i.kt)("inlineCode",{parentName:"li"},"txid")," corresponds to a confirmed transaction with at least the required amount;"),(0,i.kt)("li",{parentName:"ol"},"the server sends a ",(0,i.kt)("inlineCode",{parentName:"li"},"HistoryResponse")," to the client.")),(0,i.kt)("p",null,"In further subsections, we list the potential direction for future work towards a fully-fledged i13n mechanism."),(0,i.kt)("h2",{id:"pricing"},"Pricing"),(0,i.kt)("p",null,"For PoC, we assume a constant price per hour of history. This price and the blockchain address of the server are assumed to be common knowledge. This simplifies the client-server interaction, avoiding the price negotiation step."),(0,i.kt)("p",null,"In the future versions of the protocol, the price will be negotiated and will depend on multiple parameters, such as the total size of the relevant messages in the response."),(0,i.kt)("h3",{id:"future-work"},"Future work"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"DoS protection - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/66"},"https://github.com/waku-org/research/issues/66")),(0,i.kt)("li",{parentName:"ul"},"Cost calculation - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/35"},"https://github.com/waku-org/research/issues/35")),(0,i.kt)("li",{parentName:"ul"},"Price advertisement - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/51"},"https://github.com/waku-org/research/issues/51")),(0,i.kt)("li",{parentName:"ul"},"Price negotiation - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/52"},"https://github.com/waku-org/research/issues/52"))),(0,i.kt)("h2",{id:"payment"},"Payment"),(0,i.kt)("p",null,"For the PoC, each request is paid for with a separate transaction. The transaction hash (",(0,i.kt)("inlineCode",{parentName:"p"},"txid"),") acts as a proof of payment. The server verifies the payment by ensuring that:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"the transaction has been confirmed;"),(0,i.kt)("li",{parentName:"ol"},"the transaction is paying the proper amount to the server's account;"),(0,i.kt)("li",{parentName:"ol"},"the ",(0,i.kt)("inlineCode",{parentName:"li"},"txid")," does not correspond to any prior response.")),(0,i.kt)("p",null,"The client gives proof of payment before it receives the response. Other options could be:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"the client pays after the fact;"),(0,i.kt)("li",{parentName:"ol"},"the client pays partly upfront and partly after the fact;"),(0,i.kt)("li",{parentName:"ol"},"a centralised third party (either trusted or semi-trusted, like a smart contract) ensures atomicity;"),(0,i.kt)("li",{parentName:"ol"},"cryptographically ensured atomicity (similar to atomic swaps, Lightning, or Hopr).")),(0,i.kt)("p",null,"Our design considerations are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the PoC protocol should be simple;"),(0,i.kt)("li",{parentName:"ul"},'servers are more "permanent" entities and are more likely to have long-lived identities;'),(0,i.kt)("li",{parentName:"ul"},"it is more important to protect the clients's privacy than the server's privacy.")),(0,i.kt)("p",null,"In light of these criteria, we suggest that the client pays first. This is simpler than splitting the payment, or involving an extra atomicity-enforcing mechanism. Moreover, pre-payment is arguably more privacy-preserving than post-payment, which encourages servers to deanonymise clients to prevent fraud."),(0,i.kt)("h3",{id:"future-work-1"},"Future work"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Add more payment methods - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/58"},"https://github.com/waku-org/research/issues/58")),(0,i.kt)("li",{parentName:"ul"},"Design a subscription model with service credentials - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/59"},"https://github.com/waku-org/research/issues/59")),(0,i.kt)("li",{parentName:"ul"},"Add privacy to service credentials - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/60"},"https://github.com/waku-org/research/issues/60")),(0,i.kt)("li",{parentName:"ul"},"Consider the impact of network disruptions - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/65"},"https://github.com/waku-org/research/issues/65"))),(0,i.kt)("h2",{id:"reputation"},"Reputation"),(0,i.kt)("p",null,"We use reputation to discourage the server from taking the payment and not responding. The client keeps track of the server's reputation:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"all servers start with zero reputation points;"),(0,i.kt)("li",{parentName:"ul"},"if the server honours the request, it gets ",(0,i.kt)("inlineCode",{parentName:"li"},"+n")," points;"),(0,i.kt)("li",{parentName:"ul"},"if the server does not respond before a timeout, it gets ",(0,i.kt)("inlineCode",{parentName:"li"},"-m")," points."),(0,i.kt)("li",{parentName:"ul"},"if the server's reputation drops below ",(0,i.kt)("inlineCode",{parentName:"li"},"k")," points, the client will never query it again.")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"n"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"m"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"k")," are subject to configuration."),(0,i.kt)("p",null,"Optionally, a client may treat a given server as trusted, assigning it a constant positive reputation."),(0,i.kt)("p",null,"Potential issues:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"An attacker can establish new server identities and continue running away with clients' money. Countermeasures:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"a client only queries trusted servers (which however leads to centralisation);"),(0,i.kt)("li",{parentName:"ul"},"when querying a new server, a client first sends a small (i.e. cheap) request as a test;"),(0,i.kt)("li",{parentName:"ul"},"more generally, the client selects a server on a case-by-case basis, weighing the payment amount against the server's reputation."))),(0,i.kt)("li",{parentName:"ul"},"The ban mechanism can theoretically be abused. For instance, a competitor may attack the victim server and cause the clients who were awaiting the response to ban that server. Countermeasure: prevent DoS-attacks.")),(0,i.kt)("h3",{id:"future-work-2"},"Future work"),(0,i.kt)("p",null,"Design a more comprehensive reputation system:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"local reputation - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/48"},"https://github.com/waku-org/research/issues/48")),(0,i.kt)("li",{parentName:"ul"},"global reputation - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/49"},"https://github.com/waku-org/research/issues/49"))),(0,i.kt)("h2",{id:"results-cross-checking"},"Results cross-checking"),(0,i.kt)("p",null,"As there is no consensus over past messages, a client may want to query multiple servers and merge their responses. Cross-checking helps ensure that servers are a) not censoring real messages; b) not injecting fake messages into history. Cross-checking is absent in PoC but may be considered later."),(0,i.kt)("h3",{id:"future-work-3"},"Future work"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Cross-checking the results against censorship - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/57"},"https://github.com/waku-org/research/issues/57")),(0,i.kt)("li",{parentName:"ul"},"Use RLN to limit fake message insertion - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/38"},"https://github.com/waku-org/research/issues/38"))),(0,i.kt)("h1",{id:"evaluation"},"Evaluation"),(0,i.kt)("p",null,"We should think about what the success metrics for an incentivised protocol are, and how to measure them both in simulated settings, as well as in a live network."),(0,i.kt)("h1",{id:"longer-term-future-work"},"Longer-term future work"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Analyze privacy issues - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/61"},"https://github.com/waku-org/research/issues/61")),(0,i.kt)("li",{parentName:"ul"},"Analyze decentralised storage protocols and their relevance e.g. as back-end storage for Store servers - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/34"},"https://github.com/waku-org/research/issues/34")),(0,i.kt)("li",{parentName:"ul"},"Analyze the role of message senders, in particular, whether they should pay for sending non-ephemeral messages - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/32"},"https://github.com/waku-org/research/issues/32")),(0,i.kt)("li",{parentName:"ul"},"Generalise incentivisation protocol to other Waku light protocols (Lightpush and Filter) - see ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/waku-org/research/issues/67"},"https://github.com/waku-org/research/issues/67"),".")))}h.isMDXComponent=!0}}]);